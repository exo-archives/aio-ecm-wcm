<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" >
<!--
 * FCKeditor - The text editor for Internet - http://www.fckeditor.net
 * Copyright (C) 2003-2007 Frederico Caldeira Knabben
 *
 * == BEGIN LICENSE ==
 *
 * Licensed under the terms of any of the following licenses at your
 * choice:
 *
 *  - GNU General Public License Version 2 or later (the "GPL")
 *    http://www.gnu.org/licenses/gpl.html
 *
 *  - GNU Lesser General Public License Version 2.1 or later (the "LGPL")
 *    http://www.gnu.org/licenses/lgpl.html
 *
 *  - Mozilla Public License Version 1.1 or later (the "MPL")
 *    http://www.mozilla.org/MPL/MPL-1.1.html
 *
 * == END LICENSE ==
 *
 * Table dialog window.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Table Properties</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="robots" content="noindex, nofollow" />
	<script src="common/fck_dialog_common.js" type="text/javascript"></script>
	<script type="text/javascript">

var oEditor = window.parent.InnerDialogLoaded() ;

// Gets the document DOM
var oDOM = oEditor.FCK.EditorDocument ;

// Gets the table if there is one selected.
var table ;
var e = oEditor.FCKSelection.GetSelectedElement() ;

if ( ( !e && document.location.search.substr(1) == 'Parent' ) || ( e && e.tagName != 'TABLE' ) )
	e = oEditor.FCKSelection.MoveToAncestorNode( 'TABLE' ) ;

if ( e && e.tagName == "TABLE" )
	table = e ;

// Fired when the window loading process is finished. It sets the fields with the
// actual values if a table is selected in the editor.
window.onload = function()
{
	setTimeout(setTableValues, 500);
}

function setTableValues() 
{
	// First of all, translate the dialog box texts
	oEditor.FCKLanguageManager.TranslatePage(document) ;

	if (table)
	{
		document.getElementById('txtRows').value    = table.rows.length ;
		document.getElementById('txtColumns').value = table.rows[0].cells.length ;

		// Gets the value from the Width or the Style attribute
		var iWidth  = (table.style.width  ? table.style.width  : table.width ) ;
		var iHeight = (table.style.height ? table.style.height : table.height ) ;

		if (iWidth.indexOf('%') >= 0)			// Percentual = %
		{
			iWidth = parseInt( iWidth.substr(0,iWidth.length - 1), 10 ) ;
			document.getElementById('selWidthType').value = "percent" ;
		}
		else if (iWidth.indexOf('px') >= 0)		// Style Pixel = px
		{																										  //
			iWidth = iWidth.substr(0,iWidth.length - 2);
			document.getElementById('selWidthType').value = "pixels" ;
		}

		if (iHeight && iHeight.indexOf('px') >= 0)		// Style Pixel = px
			iHeight = iHeight.substr(0,iHeight.length - 2);
		
		//get css text of table
		var cssText = table.style.cssText.toLowerCase();

		document.getElementById('txtWidth').value		= iWidth || '' ;
		document.getElementById('txtHeight').value		= iHeight || '' ;
		document.getElementById('selAlignment').value	= GetAttribute( table, 'align', '' ) ;
		document.getElementById('txtCellSpacing').value	= getValueFromStyle(cssText, 'border-spacing');
		document.getElementById('txtSummary').value     = GetAttribute( table, 'summary', '' ) ;
		document.getElementById('txtBgColor').value     = getColorFromSingleValueStyle(cssText, "background-color");
		document.getElementById('txtInlineStyle').value = filterCSSText(cssText);
		
		if (navigator.userAgent.indexOf("Firefox") >= 0) {
			document.getElementById('txtBorder').value	= getValueFromMultiValuesStyle(cssText, 'border', 1);
			document.getElementById('txtCellPadding').value	= getValueFromStyle(table.getElementsByTagName('td')[0].style.cssText.toLowerCase(), 'padding');
			document.getElementById('txtBorderColor').value = getColorFromMultiValueStyle(cssText, 'border', 3);
		} else {
			document.getElementById('txtBorder').value	= getValueFromMultiValuesStyle(cssText, 'border-top', 2);
			document.getElementById('txtCellPadding').value	= getValueFromStyle(table.getElementsByTagName('td')[0].style.cssText.toLowerCase(), 'padding-right');
			document.getElementById('txtBorderColor').value = getColorFromMultiValueStyle(cssText, 'border-top', 1);
		}

		var eCaption = oEditor.FCKDomTools.GetFirstChild( table, 'CAPTION' ) ;
		if ( eCaption ) document.getElementById('txtCaption').value = eCaption.innerHTML ;

		document.getElementById('txtRows').disabled    = true ;
		document.getElementById('txtColumns').disabled = true ;
	}

	window.parent.SetOkButton( true ) ;
	window.parent.SetAutoSize( true ) ;
}

function filterCSSText (cssText) {
	var maskArray = new Array ("width", "height", "border", "background-color", "border-spacing", "border-right", "border-top", "border-left", "border-bottom", "margin");
	var cssArray = cssText.split(";");
	var result = "";

	for (i = 0; i < cssArray.length; i++) {
		var cssKey = cssArray[i].split(":")[0].replace(" ", "");
		if(cssKey.length > 0 && contains(maskArray, cssKey) == false) {
			result += cssArray[i] + ";";		
		}
	}

	return result;
}

function contains(array, obj) {
  var i = array.length;
  while (i--) {
    if (array[i] === obj) {
      return true;
    }
  }
  return false;
}


// Fired when the user press the OK button
function Ok()
{
	var bExists = ( table != null ) ;

	if ( ! bExists )
		table = oEditor.FCK.EditorDocument.createElement( "TABLE" ) ;

	// Removes the Width and Height styles
	if ( bExists && table.style.width )		table.style.width = null ; //.removeAttribute("width") ;
	if ( bExists && table.style.height )	table.style.height = null ; //.removeAttribute("height") ;

	var sWidth = GetE('txtWidth').value ;
	if ( sWidth.length > 0 && GetE('selWidthType').value == 'percent' )
		sWidth += '%' ;
	else sWidth += 'px' ;
	SetAttribute( table, 'align'		, GetE('selAlignment').value ) ;
	SetAttribute( table, 'summary'		, GetE('txtSummary').value ) ;
	var strStyle;
	strStyle = "width: " + sWidth + ";" + "height: " + GetE('txtHeight').value + "px;";
	strStyle += "border: " +  GetE('txtBorder').value + "px " + "solid" + " " + GetE('txtBorderColor').value + ";";
	strStyle += "background-color: " + GetE('txtBgColor').value + ";";
	strStyle += "border-collapse: separate;";
	strStyle += "border-spacing:" +  GetE('txtCellSpacing').value + "px;";	
	strStyle += GetE('txtInlineStyle').value;
	strStyle += "margin: 0 auto";
		
	table.style.cssText = strStyle;
	table.cellSpacing = GetE('txtCellSpacing').value;
	
	var eCaption = oEditor.FCKDomTools.GetFirstChild( table, 'CAPTION' ) ;

	if ( document.getElementById('txtCaption').value != '')
	{
		if ( !eCaption )
		{
			eCaption = oEditor.FCK.EditorDocument.createElement( 'CAPTION' ) ;
			table.insertBefore( eCaption, table.firstChild ) ;
		}

		eCaption.innerHTML = document.getElementById('txtCaption').value ;
	}
	else if ( bExists && eCaption )
	{
		// TODO: It causes an IE internal error if using removeChild or
		// table.deleteCaption() (see #505).
		if ( oEditor.FCKBrowserInfo.IsIE )
			eCaption.innerHTML = '' ;
		else
			eCaption.parentNode.removeChild( eCaption ) ;
	}

	if (! bExists)
	{
		var iRows = document.getElementById('txtRows').value ;
		var iCols = document.getElementById('txtColumns').value ;

		for ( var r = 0 ; r < iRows ; r++ )
		{
			var oRow = table.insertRow(-1) ;
			for ( var c = 0 ; c < iCols ; c++ )
			{
				var oCell = oRow.insertCell(-1) ;
				var strCellStyle = "border: " +  GetE('txtBorder').value + "px " + "solid" + " " + GetE('txtBorderColor').value + ";";
				strCellStyle += "padding: " +  GetE('txtCellPadding').value + "px;";
				oCell.style.cssText = strCellStyle;
				oCell.innerHTML = "&nbsp;";
				if ( oEditor.FCKBrowserInfo.IsGeckoLike )
					oEditor.FCKTools.AppendBogusBr( oCell ) ;
			}
		}

		oEditor.FCKUndo.SaveUndoStep() ;

		oEditor.FCK.InsertElement( table ) ;
	} else {
		var cells = table.getElementsByTagName('td');
		var strCellStyle = "border: " +  GetE('txtBorder').value + "px " + "solid" + " " + GetE('txtBorderColor').value + ";";
		strCellStyle += "padding: " +  GetE('txtCellPadding').value + "px;";
		for ( var i = 0 ; i < cells.length ; i++ )
		{
			cells[i].style.cssText = strCellStyle;
			if (cells[i].innerHTML.length == 0) {
				cells[i].innerHTML = "&nbsp;";		
			}
		}
	}
	
	return true ;
}

function getValueFromStyle(styleString, key) {
	var valuesArray = styleString.split(";");

	for (i = 0; i < valuesArray.length; i++)
	{
		if(valuesArray[i].split(":")[0].replace(" ", "") == key)
			return valuesArray[i].split(":")[1].replace(" ", "").replace("px", "");
	}
}

function getValueFromMultiValuesStyle(styleString, key, valueNum) {
	var valuesArray = styleString.split(";");

	for (i = 0; i < valuesArray.length; i++)
	{
		if(valuesArray[i].split(":")[0].replace(" ", "") == key)
			return (valuesArray[i].split(":")[1].split(" ")[valueNum].replace("px", ""));
	}
}

function getColorFromSingleValueStyle(styleString, key)
{
    var colorString = "";
	
	//get the list of declarations which are declared in style string
    var declarationArray = styleString.split(";");
	
	//find the delaration which we want to get the value 
	//(its property equal to the 'key' paramerter)
    for (i = 0; i < declarationArray.length; i++)
    {
        if(declarationArray[i].split(":")[0].replace(" ", "") == key)
        {
			//get the value of the delaration
            var cssValue = declarationArray[i].split(":")[1].replace(/ /g, "");
            if (cssValue.toLowerCase().indexOf("rgb") >= 0) {    //in case: color value is in RGB format
				//get the decimal values
				var colorDecimalValues = cssValue.toLowerCase().split("rgb")[1].replace(/[() ]/g,"").split(",");
                
				//convert the decimal value to hex value
				colorString = "#";
				for (k = 0; k < colorDecimalValues.length; k++)
                {
                    colorString += deciToHex(colorDecimalValues[k]);
                }                
            } else { //in case: color value is in HEX or text format
                colorString = cssValue;
            }
            break;
         }
    }
    return colorString;
}
				
function getColorFromMultiValueStyle(styleString, key, index) {
    var colorString = "";    
    
	//get the list of declarations which are declared in style string
	var declarationArray = styleString.split(";");
	
	//find the delaration which we want to get the value 
	//(its property equal to the 'key' paramerter)
    for (i = 0; i < declarationArray.length; i++) {
        if(declarationArray[i].split(":")[0].replace(" ", "") == key) {
			//get the value of the delaration
			var cssValue = declarationArray[i].split(":")[1].replace(/ /g, "");
			
			//refine the value
			if (cssValue.toLowerCase().indexOf("rgb") >= 0) {   //in case: color value is in RGB format
				//get the decimal values
				var colorDecimalValues = cssValue.substring(cssValue.indexOf("(") + 1, cssValue.indexOf(")")).split(",");
				
				//convert the decimal value to hex value
				colorString = "#";
				for (k = 0; k < colorDecimalValues.length; k++)
                {
                    colorString += deciToHex(colorDecimalValues[k]);
                }  
			} else if (cssValue.indexOf("#") >= 0) {   //in case: color value is in HEX format
				colorString = cssValue.substring(cssValue.indexOf("#"), cssValue.indexOf("#") + 7);
			} else { //in case: color value is in text format (example: red, green, blue, yellow...)
				colorString = getValueFromMultiValuesStyle(styleString, key, index);
			}
			break;
		}
	}
		
    return colorString;
}

function deciToHex(arg)
{
	res2 = 999;
	args = arg;
	while(args>15)
	{
		arg1=parseInt(args/16);
		arg2=args%16;
		arg2=getHexNum(arg2);
		args=arg1;

		if(res2 == 999)
		{
			res2=arg2.toString();
		}
		else
		{
			res2=arg2.toString()+res2.toString();
		}

	}
	if(args<16 && res2 != 999)
	{
		def = getHexNum(args);
		//document.first.deciBin.value = def;
		res2=def+res2.toString();
	}
	 else if(res2 == 999)
	{
		if(args < 16)
		{
			res2= getHexNum(args);
		}
		else
		{
			res2= 1;
		}
	}

	if(res2.length == 1)
	{
	  res2 = "0"+res2;
	}	
	return res2;
}

function getHexNum(num)
{
	ar1 = new Array('0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15');
	ar2 = new Array('0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F');
	if(num > 15)
	{
		return num;
	}
	else
	{
		red = ar2[num];
		return red;
	}
}
</script>
</head>
<body style="overflow: hidden">
	<table id="otable" cellspacing="0" cellpadding="0" width="100%" border="0" style="height: 100%">
		<tr>
			<td>
				<table cellspacing="1" cellpadding="1" width="100%" border="0" >
					<tr>
						<td valign="top">
							<table cellspacing="0" cellpadding="0" border="0">
								<tr>
									<td>
										<span fcklang="DlgTableRows">Rows</span>:</td>
									<td>
										&nbsp;<input id="txtRows" type="text" maxlength="3" size="2" value="3" name="txtRows"
											onkeypress="return IsDigit(event);" /></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableColumns">Columns</span>:</td>
									<td>
										&nbsp;<input id="txtColumns" type="text" maxlength="2" size="2" value="2" name="txtColumns"
											onkeypress="return IsDigit(event);" /></td>
								</tr>
								<tr>
									<td>
										&nbsp;</td>
									<td>
										&nbsp;</td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableBorder">Border size</span>:</td>
									<td>
										&nbsp;<input id="txtBorder" type="text" maxlength="2" size="2" value="1" name="txtBorder"
											onkeypress="return IsDigit(event);" /></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableBorderColor">Border color</span>:</td>
									<td>		
										&nbsp;<input id="txtBorderColor" type="text" size="6" value="#000000" /></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableAlign">Alignment</span>:</td>
									<td>
										&nbsp;<select id="selAlignment" name="selAlignment">
											<option fcklang="DlgTableAlignNotSet" value="" selected="selected">&lt;Not set&gt;</option>
											<option fcklang="DlgTableAlignLeft" value="left">Left</option>
											<option fcklang="DlgTableAlignCenter" value="center">Center</option>
											<option fcklang="DlgTableAlignRight" value="right">Right</option>
										</select></td>
								</tr>
							</table>
						</td>
						<td>
							&nbsp;&nbsp;&nbsp;</td>
						<td align="right" valign="top">
							<table cellspacing="0" cellpadding="0" border="0">
								<tr>
									<td>
										<span fcklang="DlgTableWidth">Width</span>:</td>
									<td>
										&nbsp;<input id="txtWidth" type="text" maxlength="4" size="3" value="200" name="txtWidth"
											onkeypress="return IsDigit(event);" /></td>
									<td>
										&nbsp;<select id="selWidthType" name="selWidthType">
											<option fcklang="DlgTableWidthPx" value="pixels" selected="selected">pixels</option>
											<option fcklang="DlgTableWidthPc" value="percent">percent</option>
										</select></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableHeight">Height</span>:</td>
									<td>
										&nbsp;<input id="txtHeight" type="text" maxlength="4" size="3" name="txtHeight" onkeypress="return IsDigit(event);" /></td>
									<td>
										&nbsp;<span fcklang="DlgTableWidthPx">pixels</span></td>
								</tr>
								<tr>
									<td>
										&nbsp;</td>
									<td>
										&nbsp;</td>
									<td>
										&nbsp;</td>
								</tr>
								<tr>
									<td nowrap="nowrap">
										<span fcklang="DlgTableCellSpace">Cell spacing</span>:</td>
									<td>
										&nbsp;<input id="txtCellSpacing" type="text" maxlength="2" size="2" value="1" name="txtCellSpacing"
											onkeypress="return IsDigit(event);" /></td>
									<td>
										&nbsp;</td>
								</tr>
								<tr>
									<td nowrap="nowrap">
										<span fcklang="DlgTableCellPad">Cell padding</span>:</td>
									<td>
										&nbsp;<input id="txtCellPadding" type="text" maxlength="2" size="2" value="1" name="txtCellPadding"
											onkeypress="return IsDigit(event);" /></td>
									<td>
										&nbsp;</td>
								</tr>
								<tr>
									<td nowrap="nowrap">
										<span fcklang="DlgTableBgColor">Background</span>:</td>
									<td>
										&nbsp;<input id="txtBgColor" type="text" size="6" name="txtBgColor" value="#FFFFFF"/></td>
									<td>
										&nbsp;</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
				<table cellspacing="0" cellpadding="0" width="100%" border="0">
					<tr>
						<td nowrap="nowrap"  valign="top">
							<span fcklang="DlgTableStyle">Style</span>:&nbsp;</td>
						<td>
							&nbsp;</td>
						<td width="100%" nowrap="nowrap">
							<textarea id="txtInlineStyle" style="width: 100%; height: 43px; overflow: auto;" ></textarea></td>
					</tr>
					<tr>
						<td nowrap="nowrap">
							<span fcklang="DlgTableCaption">Caption</span>:&nbsp;</td>
						<td>
							&nbsp;</td>
						<td width="100%" nowrap="nowrap">
							<input id="txtCaption" type="text" style="width: 100%" /></td>
					</tr>
					<tr>
						<td nowrap="nowrap">
							<span fcklang="DlgTableSummary">Summary</span>:&nbsp;</td>
						<td>
							&nbsp;</td>
						<td width="100%" nowrap="nowrap">
							<input id="txtSummary" type="text" style="width: 100%" /></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
</body>
</html>
