<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><title>eXplorer</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="eXpires" content="0">
	<script type="text/javascript" src="js/kombai.js"></script>
</head>
<body>
	<form name="doc">
		show in folder:
		<input type="text" id="dir" style="width: 256px;" value="/" onkeypress="if(event.keyCode == 13) return false;"/>
		<input type="button" onclick="sendCommand()" value="sendCommand">
	</form>
</body>
<script type="text/javascript">
var eXoPlugin = window.opener.eXoPlugin;
var eXp = {
	connector: eXoPlugin.eXoFileManager.Connector,
	resourceType: eXoPlugin.eXoFileManager.ResourceType,
	command: {
		getFiles: "getFiles",
		uploadFile: "uploadFile",
		getFolders: "getFolders",
		createFolder: "createFolder"
	},
	buildParam: function() {
		if (arguments.length < 1) return null;
		var arr = [];
		for (var i = 0; i < arguments.length; ++i) {
			arr.push(arguments[i]);
		}
		return arr.join("&");
	},
	getNodes: function(DomX, nodeName) {
		if (!DomX || !nodeName) return null;
		var node = Kombai.select({from: DomX, where: "nodeName == '" + nodeName + "'"});
		if (node.length) return node;
		else return null;
	},
	getSingleNode: function(DomX, nodeName) {
		var nodes = this.getNodes(DomX, nodeName);
		if (nodes[0]) return nodes[0];
		else return null;
	},
	getNodeValue: function(node, name) {
		return node.attributes.getNamedItem(name).value;
	},
	sendRequest: function(connector, param, callback)  {
		Kombai.request({
			address: connector,
			data: param,
			method: "GET",
			onSuccess: function() {
				if (callback && callback instanceof Function) {
					if (this.responseXML) callback(this.responseXML);
					else callback(this.responseText);
				}
			},
			onFailure: function() {
				alert('Can"t connect to sever. Please try again.');
			}
		});
	}
}



function sendCommand() {
	var connector = eXoPlugin.hostName + eXp.connector + eXp.command.getFolders;
	var param = eXp.buildParam("Type=" + eXp.resourceType , "CurrentFolder=/");
	
	function show(idata){
		var rootNode = eXp.getSingleNode(idata, "Connector");
		var resourceType = eXp.getNodeValue(rootNode, "resourceType");
		Kombai.discover(resourceType);
	}
	eXp.sendRequest(connector, param, show);
}
</script>
</html>
