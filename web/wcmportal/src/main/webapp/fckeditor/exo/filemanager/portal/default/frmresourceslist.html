<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!--
 insertPortalLink.html -------../filemanager/portal/default/browser.html.--------frmresourceslish.html.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link href="browser.css" type="text/css" rel="stylesheet" />
	<script type="text/javascript"  src="js/common.js"></script>
	<script type="text/javascript">
		// refer browse.html
		var selectFolder = function( url ) {
			//setTimeout(function(){}, 0);
			window.top.selectFolder( url );
		};

		var oListManager = new Object() ;

		oListManager.Clear = function()
		{
			document.body.innerHTML = '' ;
		}

		oListManager.GetFolderRowHtml = function( folderName, folderPath, pageUri )
		{
			// Build the link to view the folder.
			var sLink = '<a href="#" onclick="OpenFolder(\'' + folderPath.replace( /'/g, '\\\'') + '\');return false;">' ;
			alert(pageUri);
			var sHtml =
				'<tr>' +
					'<td width="16">' +
						sLink +
						'<img alt="" src="images/Folder.gif" width="16" height="16" border="0"></a>' +
					'</td><td nowrap colspan="2">&nbsp;' +
						sLink + 
						folderName + 
						'</a>' +
					'</td>';
			if (pageUri != null )
			{
				sHtml +=
					'<td width="25px">' +
						'<input type="button" value="select" onclick=\'selectFolder("'+pageUri +'");\'>' +
					'</td>' +
				'</tr>' ;
			} 
			else 
			{
				sHtml += '</tr>' ; 
			}
			 return sHtml;
		}

		function OpenFolder( folderPath )
		{
			// Load the resources list for this folder.
			window.parent.frames['frmFolders'].LoadFolders( folderPath ) ;
		}

		function OpenFile( fileUrl )
		{
			window.top.addURL(fileUrl);
		}

		function LoadResources( resourceType, folderPath )
		{
			oListManager.Clear() ;
			oConnector.ResourceType = resourceType ;
			oConnector.CurrentFolder = folderPath ;
			oConnector.SendCommand( 'GetFoldersAndFiles', null, GetFoldersAndFilesCallBack ) ;
		}

		function Refresh()
		{
			LoadResources( oConnector.ResourceType, oConnector.CurrentFolder ) ;
		}

		function GetFoldersAndFilesCallBack( fckXml )
		{
			if ( oConnector.CheckError( fckXml ) != 0 )
				return ;

			// Get the current folder path.
			var oNode = fckXml.SelectSingleNode( 'Connector/CurrentFolder' ) ;
			var sCurrentFolderPath	= oNode.attributes.getNamedItem('path').value ;
			var sCurrentFolderUrl	= oNode.attributes.getNamedItem('url').value ;
			
			var oHtml = new StringBuilder( '<table id="tableFiles" cellspacing="1" cellpadding="0" width="100%" border="0">' ) ;

			// Add the Folders.	
			var oNodes = fckXml.SelectNodes( 'Connector/Folders/Folder' ) ;
			for ( var i = 0 ; i < oNodes.length ; i++ )
			{
				var sFolderName = oNodes[i].attributes.getNamedItem('name').value ;
				if (oNodes[i].attributes.getNamedItem('pageUri'))
				{
					var sCurrentFolderUri = oNodes[i].attributes.getNamedItem('pageUri').value;
				}
				else 
				{
					var sCurrentFolderUri = null;
				}
				oHtml.Append( oListManager.GetFolderRowHtml( sFolderName, sCurrentFolderPath + sFolderName + "/" , sCurrentFolderUri) ) ;
			}

			oHtml.Append( '</table>' ) ;
			
			document.body.innerHTML = oHtml.ToString() ;

		}

		window.onload = function()
		{
			window.top.IsLoadedResourcesList = true ;
		}
	</script>
</head>
<body class="FileArea" bottommargin="10" leftmargin="10" topmargin="10" rightmargin="10">
</body>
</html>
