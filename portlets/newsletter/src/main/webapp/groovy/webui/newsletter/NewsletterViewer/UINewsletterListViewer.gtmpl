<%
import org.exoplatform.services.wcm.newsletter.NewsletterCategoryConfig;
import org.exoplatform.services.wcm.newsletter.NewsletterSubscriptionConfig;

// set link to subcripe
String url = uicomponent.url("Subcribe", "OBJECTID");
uicomponent.setLink(url);
if(uicomponent.userCode != null){
	uicomponent.setActionAgain();
}
%>
<div class="UINewsletterPortlet UINewsletterViewerForm" id="$uicomponent.id">
	<%uiform.begin()%>
		<div class="NewsletterBoxContent">
			<div class="UserName" style="height:32px;width:auto;line-height:32px;width:auto;margin-bottom:7px;">
				<div class="LeftUserName" style="float:left; margin-left:18px;">
					<%=_ctx.appRes("UINewsletterViewerForm.title.userEmail")%>
				</div>
				<div class="RightUserName" style="float:left;">
					<div class="Input" style="float:left;padding:0px 5px 0px 10px;">
						<%uicomponent.renderChild("inputEmail");%> 
						<a href="#" style="color:#0101FF;text-decoration:underline;font-weight:bold;"><%=uicomponent.userMail%></a>
					</div>
					<div class="buttonForget" style="float:left; margin-left:50px;">
						<%if (uicomponent.isUpdated == true) {%>
								<div class="UIAction"> 
				          <%String forgetAction = uicomponent.event("ForgetEmail") ;%>
				          <div class="ActionContainer">
				          	<table class="ActionContainer">
		    						<tr>
	    								<td>
								          <div onclick="$forgetAction" class="ActionButton LightBlueStyle" >
								            <div class="ButtonLeft">
								              <div class="ButtonRight">
								                <div class="ButtonMiddle">
								                  <a href="javascript:void(0);">
								                  	<%=_ctx.appRes("UINewsletterViewerForm.action.ForgetEmail")%>
								                  </a>
								                </div>
								              </div>
								            </div>
							              </div>
			      						</td>
			      					</tr>          
	    					</table>
				          </div>
				  		</div>
			  			<%}%>
					</div>
					<div style="clear:both;"><span></span></div>
				</div>
				<div class="ClearLeft"><span></span></div>
			</div>
		
		<%for(NewsletterCategoryConfig category in uicomponent.getListCategories()){%>
			<div class="UICategories" style="width:auto;">
				<div style="width:auto;">
					<!-- Category infor -->
					<div class="CategoryTitle">
						<div class="LeftTitle">
							<div class="RightTitle">
								<div class="CenterTitle">
									<a class="IconCategory" href="javaScript:void(0);"><%=category.getTitle()%></a>
								</div>
							</div>
						</div>
						<%
							def categoryDescription = category.getDescription();
							if (categoryDescription == null) categoryDescription = "";
						%>
						<div style="float:left;line-height:26px;padding-left:10px">$categoryDescription</div>
						<div class="ClearLeft"><span></span></div>
					</div>
					<!-- All subscriptions -->
					<div class="Subscriptions">
						<table cellpadding="5" cellspacing="0" border="0">
							<tr>
								<th class="Title">
									<%=_ctx.appRes("UINewsletterViewerForm.title.subscription")%>
								</th>
								<th class="Title" style="border-right:none;width:100px; white-space:nowrap; padding-left:5px; padding-right:5px;">
									<%=_ctx.appRes("UINewsletterViewerForm.title.yourStatus")%>
								</th>
							</tr>
							<%List<NewsletterSubscriptionConfig> listSubscriptions = uicomponent.getListSubscription(category.getName());
								if(listSubscriptions.size() > 0){
									int i = 0;
									String classTr = "";
									for(NewsletterSubscriptionConfig subScription in listSubscriptions){
										if(i % 2 == 0) classTr = "OddRow";
										else classTr = "EvenRow";
										i ++;
									%>
										<tr class="$classTr">
											<td>
												<div class="SubscriptionTitle"><%=subScription.getTitle()%></div>
												<div class="SubscriptionDescription">
												<%
													def subscriptionDescription = subScription.getDescription();
													if (subscriptionDescription == null) subscriptionDescription = "";
												%>
												$subscriptionDescription
												</div>
											</td>
											<td style="border:none;text-align:center;">
												<%
													uicomponent.renderChild(category.getName() + "#" + subScription.getName());
												%>
											</td>
										</tr>
							<%	}
								}else{%>
									<tr class="OddRow">
										<td colspan="2"><span></span></td>
									</tr>
							<%}%>
						</table>
					</div>
				</div>
			</div>
		<%}%>
		</div>
		
		<div class="UIAction"> 
	    <table class="ActionContainer">
	    	<tr>
	    		<td>
	          <%
	          for(action in uicomponent.getActions()) { 
	      			if ("ForgetEmail".equals(action)) continue;
	          	String actionLabel = _ctx.appRes(uicomponent.getName() + ".action." + action); 
		    			String link = uicomponent.event(action) ;
	          %>
			          <div onclick="$link" class="ActionButton LightBlueStyle" >
			            <div class="ButtonLeft">
			              <div class="ButtonRight">
			                <div class="ButtonMiddle">
			                  <a href="javascript:void(0);">
													$actionLabel
												</a>
			                </div>
			              </div>
			            </div>
			          </div>
	      		<%}%>
	      	</td>
	      </tr>
	    </table>
	  </div>
	  <%uicomponent.userCode = null;%>
	<%uiform.end()%>
</div>
